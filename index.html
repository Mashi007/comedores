<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gesti√≥n de Comedores Industriales</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üçΩÔ∏è</text></svg>">
    <link rel="shortcut icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üçΩÔ∏è</text></svg>">
    <link rel="apple-touch-icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üçΩÔ∏è</text></svg>">
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="utils.js"></script>
</head>
<body>
    <div id="toast-container"></div>
    
    <!-- Portada -->
    <div id="portada" class="screen active">
        <div class="portada-background">
            <div class="gradient-orb orb-1"></div>
            <div class="gradient-orb orb-2"></div>
            <div class="gradient-orb orb-3"></div>
        </div>
        <div class="portada-container">
            <div class="portada-content">
                <div class="portada-logo">üçΩÔ∏è</div>
                <h1 class="portada-title">
                    <span class="title-line">Sistema de Gesti√≥n</span>
                    <span class="title-line highlight">Comedores Industriales</span>
                </h1>
                <p class="portada-subtitle">Transforma la gesti√≥n de tu comedor con tecnolog√≠a de vanguardia</p>
                <div class="portada-features">
                    <div class="feature-item">
                        <span class="feature-icon">üìä</span>
                        <span>Analytics en Tiempo Real</span>
                    </div>
                    <div class="feature-item">
                        <span class="feature-icon">ü§ñ</span>
                        <span>IA Integrada</span>
                    </div>
                    <div class="feature-item">
                        <span class="feature-icon">‚ö°</span>
                        <span>Optimizaci√≥n Autom√°tica</span>
                    </div>
                </div>
                <button id="btnIniciar" class="btn-hero" type="button" onclick="cambiarPantalla('portada', 'menu'); return false;">
                    <span>Ingresar al Sistema</span>
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M7.5 15L12.5 10L7.5 5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
            </div>
        </div>
    </div>

    <!-- Sidebar -->
    <div id="sidebar" class="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-logo">
                <span class="logo-icon">üçΩÔ∏è</span>
                <div class="logo-text">
                    <span class="logo-title">Comedores</span>
                    <span class="logo-subtitle">Industrial</span>
                </div>
            </div>
        </div>
        <nav class="sidebar-nav">
            <a href="#" class="nav-item" onclick="navegar('menu'); return false;" data-section="menu">
                <span class="nav-icon">üè†</span>
                <span class="nav-text">Men√∫ Principal</span>
            </a>
            <a href="#" class="nav-item" onclick="navegar('dashboard'); return false;" data-section="dashboard">
                <span class="nav-icon">üìä</span>
                <span class="nav-text">Dashboard</span>
                <span class="nav-badge">6</span>
            </a>
            <a href="#" class="nav-item" onclick="navegar('compras'); return false;" data-section="compras">
                <span class="nav-icon">üõí</span>
                <span class="nav-text">Compras</span>
                <span class="nav-new">Nuevo</span>
            </a>
            <a href="#" class="nav-item" onclick="navegar('inventario'); return false;" data-section="inventario">
                <span class="nav-icon">üì¶</span>
                <span class="nav-text">Inventario</span>
            </a>
            <a href="#" class="nav-item" onclick="navegar('planificacion'); return false;" data-section="planificacion">
                <span class="nav-icon">üìÖ</span>
                <span class="nav-text">Planificaci√≥n</span>
            </a>
            <a href="#" class="nav-item" onclick="navegar('produccion'); return false;" data-section="produccion">
                <span class="nav-icon">üë®‚Äçüç≥</span>
                <span class="nav-text">Producci√≥n</span>
            </a>
            <a href="#" class="nav-item" onclick="navegar('servicio'); return false;" data-section="servicio">
                <span class="nav-icon">üí¨</span>
                <span class="nav-text">Servicio al Cliente</span>
            </a>
            <a href="#" class="nav-item" onclick="navegar('notificaciones'); return false;" data-section="notificaciones">
                <span class="nav-icon">üîî</span>
                <span class="nav-text">Notificaciones</span>
                <span class="nav-badge">5</span>
            </a>
            <a href="#" class="nav-item" onclick="navegar('chat-ai'); return false;" data-section="chat-ai">
                <span class="nav-icon">ü§ñ</span>
                <span class="nav-text">Chat AI</span>
                <span class="nav-new">Nuevo</span>
            </a>
            <a href="#" class="nav-item" onclick="navegar('configuracion'); return false;" data-section="configuracion">
                <span class="nav-icon">‚öôÔ∏è</span>
                <span class="nav-text">Configuraci√≥n</span>
            </a>
        </nav>
        <div class="sidebar-footer">
            <div class="sidebar-user" onclick="toggleUserMenu()">
                <div class="user-avatar">U</div>
                <div class="user-info">
                    <span class="user-name">Usuario Demo</span>
                    <span class="user-role">Administrador</span>
                </div>
                <span class="user-menu-arrow">‚ñº</span>
            </div>
            <div class="user-menu" id="userMenu">
                <a href="#" class="user-menu-item" onclick="cerrarSesion(); return false;">
                    <span class="nav-icon">üö™</span>
                    <span class="nav-text">Cerrar Sesi√≥n</span>
                </a>
            </div>
        </div>
    </div>

    <div id="sidebarOverlay" class="sidebar-overlay" onclick="toggleSidebar()"></div>

    <!-- Men√∫ Principal -->
    <div id="menu" class="screen">
        <div class="page-container">
            <div class="page-header">
                <button class="menu-toggle" onclick="toggleSidebar()">‚ò∞</button>
                <h1>Men√∫ Principal</h1>
            </div>
            <div class="menu-grid">
                <div class="menu-card" onclick="navegar('dashboard')">
                    <div class="menu-icon">üìä</div>
                    <h3>Dashboard</h3>
                    <p>Visualizaci√≥n de m√©tricas y KPIs</p>
                </div>
                <div class="menu-card" onclick="navegar('compras')">
                    <div class="menu-icon">üõí</div>
                    <h3>Compras</h3>
                    <p>Gesti√≥n de compras y facturas</p>
                </div>
                <div class="menu-card" onclick="navegar('inventario')">
                    <div class="menu-icon">üì¶</div>
                    <h3>Inventario</h3>
                    <p>Control de inventario</p>
                </div>
                <div class="menu-card" onclick="navegar('planificacion')">
                    <div class="menu-icon">üìÖ</div>
                    <h3>Planificaci√≥n</h3>
                    <p>Planificaci√≥n de men√∫s</p>
                </div>
                <div class="menu-card" onclick="navegar('produccion')">
                    <div class="menu-icon">üë®‚Äçüç≥</div>
                    <h3>Producci√≥n</h3>
                    <p>Reporte de producci√≥n</p>
                </div>
                <div class="menu-card" onclick="navegar('servicio')">
                    <div class="menu-icon">üí¨</div>
                    <h3>Servicio al Cliente</h3>
                    <p>Encuestas y feedback</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Dashboard -->
    <div id="dashboard" class="screen">
        <div class="page-container">
            <div class="page-header">
                <button class="menu-toggle" onclick="toggleSidebar()">‚ò∞</button>
                <h1>Dashboard</h1>
            </div>
            <div class="charts-grid">
                <div class="chart-card">
                    <h3>Consumo de Inventario</h3>
                    <canvas id="chart1" width="400" height="250"></canvas>
                </div>
                <div class="chart-card">
                    <h3>Distribuci√≥n de Compras</h3>
                    <canvas id="chart2" width="400" height="250"></canvas>
                </div>
                <div class="chart-card">
                    <h3>Producci√≥n Diaria</h3>
                    <canvas id="chart3" width="400" height="250"></canvas>
                </div>
                <div class="chart-card">
                    <h3>Top Productos</h3>
                    <canvas id="chart4" width="400" height="250"></canvas>
                </div>
                <div class="chart-card">
                    <h3>Satisfacci√≥n</h3>
                    <canvas id="chart5" width="400" height="250"></canvas>
                </div>
                <div class="chart-card">
                    <h3>Merma vs Planificado</h3>
                    <canvas id="chart6" width="400" height="250"></canvas>
                </div>
                <div class="chart-card">
                    <h3>Merma por Receta</h3>
                    <canvas id="chart7" width="400" height="250"></canvas>
                </div>
                <div class="chart-card">
                    <h3>Inventario por Producto (Burbujas)</h3>
                    <canvas id="chart8" width="400" height="250"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Compras -->
    <div id="compras" class="screen">
        <div class="page-container">
            <div class="page-header">
                <button class="menu-toggle" onclick="toggleSidebar()">‚ò∞</button>
                <h1>Gesti√≥n de Compras</h1>
                <button class="btn-primary" onclick="mostrarSimuladorOCR()">üì∑ Simular OCR WhatsApp</button>
            </div>
            
            <!-- Simulador OCR -->
            <div id="simuladorOCR" class="ocr-simulator" style="display: none;">
                <div class="ocr-container">
                    <div class="ocr-header">
                        <h2>üì∑ Simulador de OCR - Captura de Factura</h2>
                        <button class="btn-close" onclick="cerrarSimuladorOCR()">√ó</button>
                    </div>
                    <div class="ocr-preview">
                        <div class="factura-mock">
                            <div class="factura-header">
                                <h3>FACTURA DE COMPRA</h3>
                                <p>Proveedor: <strong>Distribuidora Alimentos S.A.</strong></p>
                                <p>Fecha: <strong id="fechaFactura">15/01/2025</strong></p>
                                <p>N¬∞ Factura: <strong>FAC-2025-001234</strong></p>
                            </div>
                            <div class="factura-items">
                                <table class="factura-table">
                                    <thead>
                                        <tr>
                                            <th>Producto</th>
                                            <th>Cantidad</th>
                                            <th>Unidad</th>
                                            <th>Precio Unit.</th>
                                            <th>Total</th>
                                        </tr>
                                    </thead>
                                    <tbody id="facturaItems">
                                        <tr>
                                            <td>Arroz Premium</td>
                                            <td>200</td>
                                            <td>kg</td>
                                            <td>$15.00</td>
                                            <td>$3,000.00</td>
                                        </tr>
                                        <tr>
                                            <td>Frijoles Negros</td>
                                            <td>50</td>
                                            <td>kg</td>
                                            <td>$25.00</td>
                                            <td>$1,250.00</td>
                                        </tr>
                                        <tr>
                                            <td>Pollo Entero</td>
                                            <td>150</td>
                                            <td>kg</td>
                                            <td>$30.00</td>
                                            <td>$4,500.00</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <div class="factura-total">
                                <p><strong>TOTAL: $8,750.00</strong></p>
                            </div>
                        </div>
                    </div>
                    <div class="ocr-actions">
                        <button class="btn-secondary" onclick="cerrarSimuladorOCR()">Cancelar</button>
                        <button class="btn-primary" onclick="procesarFacturaOCR()">‚úÖ Procesar Factura</button>
                    </div>
                </div>
            </div>

            <!-- Formulario de Digitalizaci√≥n -->
            <div id="formularioDigitalizacion" class="digitalizacion-form" style="display: none;">
                <div class="form-container">
                    <div class="form-header">
                        <h2>üìù Digitalizaci√≥n de Factura</h2>
                        <button class="btn-close" onclick="cerrarFormularioDigitalizacion()">√ó</button>
                    </div>
                    <form id="facturaForm" onsubmit="guardarFactura(event)">
                        <div class="form-group">
                            <label>Proveedor</label>
                            <input type="text" id="proveedor" value="Distribuidora Alimentos S.A." required>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Fecha de Factura</label>
                                <input type="date" id="fechaFacturaInput" required>
                            </div>
                            <div class="form-group">
                                <label>N¬∞ Factura</label>
                                <input type="text" id="numeroFactura" value="FAC-2025-001234" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Productos</label>
                            <div id="productosList">
                                <div class="producto-item">
                                    <input type="text" placeholder="Producto" value="Arroz Premium" required>
                                    <input type="number" placeholder="Cantidad" value="200" step="0.01" required>
                                    <select required>
                                        <option value="kg" selected>kg</option>
                                        <option value="g">g</option>
                                        <option value="L">L</option>
                                        <option value="unidad">unidad</option>
                                    </select>
                                    <input type="number" placeholder="Precio Unit." value="15.00" step="0.01" required>
                                    <button type="button" class="btn-remove" onclick="this.parentElement.remove()">√ó</button>
                                </div>
                                <div class="producto-item">
                                    <input type="text" placeholder="Producto" value="Frijoles Negros" required>
                                    <input type="number" placeholder="Cantidad" value="50" step="0.01" required>
                                    <select required>
                                        <option value="kg" selected>kg</option>
                                        <option value="g">g</option>
                                        <option value="L">L</option>
                                        <option value="unidad">unidad</option>
                                    </select>
                                    <input type="number" placeholder="Precio Unit." value="25.00" step="0.01" required>
                                    <button type="button" class="btn-remove" onclick="this.parentElement.remove()">√ó</button>
                                </div>
                                <div class="producto-item">
                                    <input type="text" placeholder="Producto" value="Pollo Entero" required>
                                    <input type="number" placeholder="Cantidad" value="150" step="0.01" required>
                                    <select required>
                                        <option value="kg" selected>kg</option>
                                        <option value="g">g</option>
                                        <option value="L">L</option>
                                        <option value="unidad">unidad</option>
                                    </select>
                                    <input type="number" placeholder="Precio Unit." value="30.00" step="0.01" required>
                                    <button type="button" class="btn-remove" onclick="this.parentElement.remove()">√ó</button>
                                </div>
                            </div>
                            <button type="button" class="btn-add" onclick="agregarProducto()">+ Agregar Producto</button>
                        </div>
                        <div class="form-actions">
                            <button type="button" class="btn-secondary" onclick="cerrarFormularioDigitalizacion()">Cancelar</button>
                            <button type="submit" class="btn-primary">üíæ Guardar y Ver KARDEX</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Dashboard KARDEX - PERMANENTE -->
            <div id="dashboardKardex" class="kardex-dashboard">
                <div class="kardex-header">
                    <h2>üìä KARDEX de Inventario</h2>
                    <div class="kardex-filters">
                        <select id="filtroProducto" onchange="filtrarKardex()">
                            <option value="">Todos los productos</option>
                        </select>
                    </div>
                </div>
                <div class="kardex-table-container">
                    <table class="kardex-table">
                        <thead>
                            <tr>
                                <th>Fecha</th>
                                <th>Producto</th>
                                <th>Saldo Inicial</th>
                                <th>Ingreso (Compra)</th>
                                <th>Salida (Consumo)</th>
                                <th>Saldo Final</th>
                                <th>Consumo Promedio/d√≠a</th>
                                <th>D√≠as Estimados</th>
                                <th>Estado</th>
                            </tr>
                        </thead>
                        <tbody id="kardexBody">
                            <!-- Se llenar√° din√°micamente -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Lista de compras -->
            <div class="compras-list">
                <h2>Historial de Compras</h2>
                <div id="listaCompras">
                    <!-- Se llenar√° din√°micamente -->
                </div>
            </div>
        </div>
    </div>

    <!-- Inventario -->
    <div id="inventario" class="screen">
        <div class="page-container">
            <div class="page-header">
                <button class="menu-toggle" onclick="toggleSidebar()">‚ò∞</button>
                <h1>üì¶ Gesti√≥n de Inventario</h1>
                <button class="btn-primary" onclick="mostrarFormularioInventario()">‚ûï Nuevo Movimiento</button>
            </div>

            <!-- KPIs de Estados de Inventario -->
            <div class="inventario-kpis">
                <div class="kpi-card inventario-minimo">
                    <div class="kpi-icon">üî¥</div>
                    <div class="kpi-content">
                        <h3 id="kpiMinimo">0</h3>
                        <p>Bajo M√≠nimo</p>
                        <span class="kpi-trend negative">Cr√≠tico</span>
                    </div>
                </div>
                <div class="kpi-card inventario-seguridad">
                    <div class="kpi-icon">üü†</div>
                    <div class="kpi-content">
                        <h3 id="kpiSeguridad">0</h3>
                        <p>En Seguridad</p>
                        <span class="kpi-trend neutral">Atenci√≥n</span>
                    </div>
                </div>
                <div class="kpi-card inventario-adecuado">
                    <div class="kpi-icon">üü¢</div>
                    <div class="kpi-content">
                        <h3 id="kpiAdecuado">0</h3>
                        <p>Stock Adecuado</p>
                        <span class="kpi-trend positive">√ìptimo</span>
                    </div>
                </div>
                <div class="kpi-card inventario-sobrestock">
                    <div class="kpi-icon">üîµ</div>
                    <div class="kpi-content">
                        <h3 id="kpiSobreStock">0</h3>
                        <p>Sobre Stock</p>
                        <span class="kpi-trend neutral">Exceso</span>
                    </div>
                </div>
            </div>

            <!-- Gr√°ficos de Inventario -->
            <div class="inventario-charts">
                <div class="chart-card">
                    <h3>üìä Distribuci√≥n por Estado</h3>
                    <canvas id="chartInventarioEstados" width="400" height="250"></canvas>
                </div>
                <div class="chart-card">
                    <h3>üìà Evoluci√≥n de Inventario</h3>
                    <canvas id="chartInventarioEvolucion" width="400" height="250"></canvas>
                </div>
                <div class="chart-card">
                    <h3>üéØ Desempe√±o vs Planificaci√≥n</h3>
                    <canvas id="chartDesempenoPlanificacion" width="400" height="250"></canvas>
                </div>
            </div>

            <!-- Tabla de Inventario -->
            <div class="inventario-table-container">
                <div class="table-header">
                    <h2>üìã Inventario de Productos</h2>
                    <div class="table-filters">
                        <select id="filtroEstadoInventario" onchange="filtrarInventario()">
                            <option value="">Todos los estados</option>
                            <option value="minimo">Bajo M√≠nimo</option>
                            <option value="seguridad">En Seguridad</option>
                            <option value="adecuado">Stock Adecuado</option>
                            <option value="sobrestock">Sobre Stock</option>
                        </select>
                        <input type="text" id="buscarProducto" placeholder="üîç Buscar producto..." onkeyup="filtrarInventario()">
                    </div>
                </div>
                <div class="table-wrapper">
                    <table class="inventario-table">
                        <thead>
                            <tr>
                                <th>Producto</th>
                                <th>Saldo Inicial</th>
                                <th>√öltima Compra</th>
                                <th>Ingresos</th>
                                <th>Salidas</th>
                                <th>Stock Actual</th>
                                <th>M√≠nimo</th>
                                <th>Seguridad</th>
                                <th>Estado</th>
                                <th>Desempe√±o</th>
                                <th>Acciones</th>
                            </tr>
                        </thead>
                        <tbody id="tablaInventarioBody">
                            <!-- Se llenar√° din√°micamente -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Historial de Movimientos -->
            <div class="movimientos-container">
                <h2>üìú Historial de Movimientos</h2>
                <div class="table-wrapper">
                    <table class="movimientos-table">
                        <thead>
                            <tr>
                                <th>Fecha</th>
                                <th>Producto</th>
                                <th>Tipo</th>
                                <th>Cantidad</th>
                                <th>Qui√©n Solicita</th>
                                <th>Saldo Anterior</th>
                                <th>Saldo Final</th>
                            </tr>
                        </thead>
                        <tbody id="historialMovimientosBody">
                            <!-- Se llenar√° din√°micamente -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Formulario de Movimiento de Inventario -->
    <div id="formularioInventario" class="modal-inventario" style="display: none;">
        <div class="modal-content-inventario">
            <div class="modal-header">
                <h2>‚ûï Nuevo Movimiento de Inventario</h2>
                <button class="btn-close" onclick="cerrarFormularioInventario()">√ó</button>
            </div>
            <form id="movimientoForm" onsubmit="procesarMovimientoInventario(event)">
                <div class="form-group">
                    <label for="tipoMovimiento">Tipo de Movimiento *</label>
                    <select id="tipoMovimiento" required onchange="toggleSolicitante()">
                        <option value="">Seleccione...</option>
                        <option value="entrada">üì• Entrada (Compra)</option>
                        <option value="salida">üì§ Salida (Consumo)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="productoMovimiento">Producto *</label>
                    <select id="productoMovimiento" required>
                        <option value="">Seleccione un producto...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="cantidadMovimiento">Cantidad *</label>
                    <input type="number" id="cantidadMovimiento" step="0.01" min="0.01" required placeholder="Ej: 50.5">
                </div>
                <div class="form-group">
                    <label for="unidadMovimiento">Unidad *</label>
                    <select id="unidadMovimiento" required>
                        <option value="kg">kg</option>
                        <option value="g">g</option>
                        <option value="L">L</option>
                        <option value="unidad">unidad</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="fechaMovimiento">Fecha *</label>
                    <input type="date" id="fechaMovimiento" required>
                </div>
                <div class="form-group" id="grupoSolicitante" style="display: none;">
                    <label for="solicitanteMovimiento">Qui√©n Solicita *</label>
                    <input type="text" id="solicitanteMovimiento" placeholder="Ej: Cocina, Producci√≥n, etc.">
                </div>
                <div class="form-group">
                    <label for="observacionesMovimiento">Observaciones</label>
                    <textarea id="observacionesMovimiento" rows="3" placeholder="Notas adicionales..."></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn-secondary" onclick="cerrarFormularioInventario()">Cancelar</button>
                    <button type="submit" class="btn-primary">üíæ Guardar Movimiento</button>
                </div>
            </form>
        </div>
    </div>

    <div id="planificacion" class="screen">
        <div class="page-container">
            <div class="page-header">
                <button class="menu-toggle" onclick="toggleSidebar()">‚ò∞</button>
                <h1>Planificaci√≥n</h1>
            </div>
            <p>M√≥dulo de planificaci√≥n</p>
        </div>
    </div>

    <div id="produccion" class="screen">
        <div class="page-container">
            <div class="page-header">
                <button class="menu-toggle" onclick="toggleSidebar()">‚ò∞</button>
                <h1>Producci√≥n</h1>
            </div>
            <p>M√≥dulo de producci√≥n</p>
        </div>
    </div>

    <div id="servicio" class="screen">
        <div class="page-container">
            <div class="page-header">
                <button class="menu-toggle" onclick="toggleSidebar()">‚ò∞</button>
                <h1>‚≠ê Satisfacci√≥n al Cliente</h1>
                <button class="btn-primary" onclick="crearEncuesta()">üìù Crear Nueva Encuesta</button>
            </div>
            
            <!-- KPIs de Satisfacci√≥n -->
            <div class="satisfaccion-kpis">
                <div class="kpi-card">
                    <div class="kpi-icon">‚≠ê</div>
                    <div class="kpi-content">
                        <h3 id="kpiPromedio">4.7</h3>
                        <p>Calificaci√≥n Promedio</p>
                        <span class="kpi-trend positive">‚Üë +0.2</span>
                    </div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-icon">üìä</div>
                    <div class="kpi-content">
                        <h3 id="kpiRespuestas">127</h3>
                        <p>Total Respuestas</p>
                        <span class="kpi-trend positive">‚Üë +12</span>
                    </div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-icon">üéØ</div>
                    <div class="kpi-content">
                        <h3 id="kpiNPS">68%</h3>
                        <p>NPS (Net Promoter Score)</p>
                        <span class="kpi-trend positive">‚Üë +5%</span>
                    </div>
                </div>
                <div class="kpi-card">
                    <div class="kpi-icon">üîÑ</div>
                    <div class="kpi-content">
                        <h3 id="kpiRegreso">87%</h3>
                        <p>Intenci√≥n de Regreso</p>
                        <span class="kpi-trend positive">‚Üë +3%</span>
                    </div>
                </div>
            </div>

            <!-- Medidas de Tendencia Central -->
            <div class="tendencia-central">
                <h2>üìä Medidas de Tendencia Central</h2>
                <div class="tendencia-grid">
                    <div class="tendencia-card">
                        <h3>Media Aritm√©tica</h3>
                        <p class="tendencia-valor" id="mediaAritmetica">4.68</p>
                        <p class="tendencia-desc">Promedio de todas las calificaciones</p>
                    </div>
                    <div class="tendencia-card">
                        <h3>Mediana</h3>
                        <p class="tendencia-valor" id="mediana">4.7</p>
                        <p class="tendencia-desc">Valor central de las calificaciones</p>
                    </div>
                    <div class="tendencia-card">
                        <h3>Moda</h3>
                        <p class="tendencia-valor" id="moda">4.8</p>
                        <p class="tendencia-desc">Calificaci√≥n m√°s frecuente</p>
                    </div>
                    <div class="tendencia-card">
                        <h3>Desviaci√≥n Est√°ndar</h3>
                        <p class="tendencia-valor" id="desviacion">0.42</p>
                        <p class="tendencia-desc">Variabilidad de las respuestas</p>
                    </div>
                </div>
            </div>

            <!-- Gr√°ficos Estrat√©gicos -->
            <div class="satisfaccion-charts">
                <div class="chart-card">
                    <h3>üìà Evoluci√≥n de Satisfacci√≥n</h3>
                    <canvas id="chartSatisfaccionEvolucion" width="400" height="250"></canvas>
                </div>
                <div class="chart-card">
                    <h3>üéØ Satisfacci√≥n por Categor√≠a</h3>
                    <canvas id="chartSatisfaccionCategorias" width="400" height="250"></canvas>
                </div>
                <div class="chart-card">
                    <h3>üîÑ Intenci√≥n de Regreso (NPS)</h3>
                    <canvas id="chartNPS" width="400" height="250"></canvas>
                </div>
                <div class="chart-card">
                    <h3>üìä Distribuci√≥n de Calificaciones</h3>
                    <canvas id="chartDistribucion" width="400" height="250"></canvas>
                </div>
                <div class="chart-card">
                    <h3>‚≠ê Comparativa de Variables</h3>
                    <canvas id="chartComparativa" width="400" height="250"></canvas>
                </div>
                <div class="chart-card">
                    <h3>üìÖ Satisfacci√≥n por D√≠a de la Semana</h3>
                    <canvas id="chartDiaSemana" width="400" height="250"></canvas>
                </div>
            </div>

            <!-- An√°lisis Detallado -->
            <div class="analisis-detallado">
                <h2>üîç An√°lisis Detallado por Variable</h2>
                <div class="variables-grid" id="variablesGrid">
                    <!-- Se llenar√° din√°micamente -->
                </div>
            </div>
        </div>
    </div>

    <div id="notificaciones" class="screen">
        <div class="page-container">
            <div class="page-header">
                <button class="menu-toggle" onclick="toggleSidebar()">‚ò∞</button>
                <h1>Notificaciones</h1>
            </div>
            <p>M√≥dulo de notificaciones</p>
        </div>
    </div>

    <!-- Notificaciones -->
    <div id="notificaciones" class="screen">
        <div class="page-container">
            <div class="page-header">
                <button class="menu-toggle" onclick="toggleSidebar()">‚ò∞</button>
                <h1>Notificaciones y Alertas</h1>
                <button class="btn-primary" onclick="marcarTodasLeidas()">Marcar todas como le√≠das</button>
            </div>
            <div class="notificaciones-grid">
                <div class="notificacion-card urgente">
                    <div class="notificacion-header">
                        <span class="notificacion-icon">‚ö†Ô∏è</span>
                        <span class="notificacion-titulo">Inventario Cr√≠tico</span>
                        <span class="notificacion-badge">Urgente</span>
                    </div>
                    <div class="notificacion-body">
                        <p>El inventario de <strong>Frijoles</strong> ha alcanzado el nivel m√≠nimo. Stock actual: <strong>8 kg</strong> (M√≠nimo: 10 kg)</p>
                        <div class="notificacion-acciones">
                            <button class="btn-small" onclick="gestionarNotificacion('inventario-frijoles')">Gestionar Compra</button>
                            <button class="btn-small btn-secondary" onclick="marcarLeida('notif-1')">Marcar Le√≠da</button>
                        </div>
                    </div>
                    <div class="notificacion-footer">
                        <span class="notificacion-tiempo">Hace 15 minutos</span>
                    </div>
                </div>

                <div class="notificacion-card importante">
                    <div class="notificacion-header">
                        <span class="notificacion-icon">üìä</span>
                        <span class="notificacion-titulo">Consumo Superior al Planificado</span>
                        <span class="notificacion-badge">Importante</span>
                    </div>
                    <div class="notificacion-body">
                        <p>Se ha consumido <strong>15% m√°s de Arroz</strong> de lo planificado. Consumo: <strong>520 kg</strong> vs Planificado: <strong>450 kg</strong></p>
                        <div class="notificacion-acciones">
                            <button class="btn-small" onclick="gestionarNotificacion('consumo-arroz')">Ver Detalle</button>
                            <button class="btn-small btn-secondary" onclick="marcarLeida('notif-2')">Marcar Le√≠da</button>
                        </div>
                    </div>
                    <div class="notificacion-footer">
                        <span class="notificacion-tiempo">Hace 2 horas</span>
                    </div>
                </div>

                <div class="notificacion-card informativa">
                    <div class="notificacion-header">
                        <span class="notificacion-icon">üìÖ</span>
                        <span class="notificacion-titulo">Men√∫ del D√≠a Pendiente</span>
                        <span class="notificacion-badge">Informativa</span>
                    </div>
                    <div class="notificacion-body">
                        <p>El men√∫ para <strong>ma√±ana</strong> a√∫n no ha sido planificado. Se recomienda completar la planificaci√≥n antes de las 18:00</p>
                        <div class="notificacion-acciones">
                            <button class="btn-small" onclick="gestionarNotificacion('menu-pendiente')">Planificar Men√∫</button>
                            <button class="btn-small btn-secondary" onclick="marcarLeida('notif-3')">Marcar Le√≠da</button>
                        </div>
                    </div>
                    <div class="notificacion-footer">
                        <span class="notificacion-tiempo">Hace 4 horas</span>
                    </div>
                </div>

                <div class="notificacion-card importante">
                    <div class="notificacion-header">
                        <span class="notificacion-icon">üì¶</span>
                        <span class="notificacion-titulo">Pedido de Compra Pendiente</span>
                        <span class="notificacion-badge">Importante</span>
                    </div>
                    <div class="notificacion-body">
                        <p>Hay <strong>3 pedidos de compra</strong> pendientes de aprobaci√≥n. Total estimado: <strong>$12,450</strong></p>
                        <div class="notificacion-acciones">
                            <button class="btn-small" onclick="gestionarNotificacion('pedidos-pendientes')">Revisar Pedidos</button>
                            <button class="btn-small btn-secondary" onclick="marcarLeida('notif-4')">Marcar Le√≠da</button>
                        </div>
                    </div>
                    <div class="notificacion-footer">
                        <span class="notificacion-tiempo">Hace 6 horas</span>
                    </div>
                </div>

                <div class="notificacion-card informativa">
                    <div class="notificacion-header">
                        <span class="notificacion-icon">‚≠ê</span>
                        <span class="notificacion-titulo">Nueva Encuesta de Satisfacci√≥n</span>
                        <span class="notificacion-badge">Informativa</span>
                    </div>
                    <div class="notificacion-body">
                        <p>Se han recibido <strong>12 nuevas respuestas</strong> a la encuesta de satisfacci√≥n. Calificaci√≥n promedio: <strong>4.7/5</strong></p>
                        <div class="notificacion-acciones">
                            <button class="btn-small" onclick="gestionarNotificacion('encuestas-nuevas')">Ver Resultados</button>
                            <button class="btn-small btn-secondary" onclick="marcarLeida('notif-5')">Marcar Le√≠da</button>
                        </div>
                    </div>
                    <div class="notificacion-footer">
                        <span class="notificacion-tiempo">Hace 1 d√≠a</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Chat AI -->
    <div id="chat-ai" class="screen">
        <div class="page-container">
            <div class="page-header">
                <button class="menu-toggle" onclick="toggleSidebar()">‚ò∞</button>
                <h1>ü§ñ Asistente AI para Gesti√≥n de Comedores</h1>
            </div>
            <div class="chat-container">
                <div class="chat-messages" id="chatMessages">
                    <div class="chat-message ai-message">
                        <div class="message-avatar">ü§ñ</div>
                        <div class="message-content">
                            <div class="message-text">¬°Hola! Soy tu asistente AI para gesti√≥n de comedores. ¬øEn qu√© puedo ayudarte hoy?</div>
                            <div class="message-time">Ahora</div>
                        </div>
                    </div>
                    <div class="chat-message ai-message">
                        <div class="message-avatar">ü§ñ</div>
                        <div class="message-content">
                            <div class="message-text">Puedo ayudarte con:<br>‚Ä¢ An√°lisis de consumo e inventario<br>‚Ä¢ Sugerencias de men√∫s<br>‚Ä¢ Optimizaci√≥n de compras<br>‚Ä¢ An√°lisis de satisfacci√≥n<br>‚Ä¢ Y mucho m√°s...</div>
                            <div class="message-time">Ahora</div>
                        </div>
                    </div>
                </div>
                <div class="chat-suggestions">
                    <button class="suggestion-btn" onclick="enviarMensajeAI('Analiza el inventario actual')">üì¶ Analizar inventario</button>
                    <button class="suggestion-btn" onclick="enviarMensajeAI('¬øQu√© consumos est√°n fuera de lo planificado?')">üìä Consumos fuera de plan</button>
                    <button class="suggestion-btn" onclick="enviarMensajeAI('¬øCu√°l es la receta con mayor merma y en qu√© fecha?')">üìâ Mayor merma</button>
                    <button class="suggestion-btn" onclick="enviarMensajeAI('Sugiere un men√∫ para ma√±ana')">üìÖ Sugerir men√∫</button>
                    <button class="suggestion-btn" onclick="enviarMensajeAI('¬øQu√© productos est√°n cr√≠ticos?')">üö® Productos cr√≠ticos</button>
                    <button class="suggestion-btn" onclick="enviarMensajeAI('Dame un reporte ejecutivo')">üìã Reporte ejecutivo</button>
                </div>
                <div class="chat-input-container">
                    <input type="text" id="chatInput" class="chat-input" placeholder="Escribe tu pregunta..." onkeypress="if(event.key === 'Enter') enviarMensajeAI()">
                    <button class="chat-send-btn" onclick="enviarMensajeAI()">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M18 2L9 11M18 2L12 18L9 11M18 2L2 8L9 11" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="configuracion" class="screen">
        <div class="page-container">
            <div class="page-header">
                <button class="menu-toggle" onclick="toggleSidebar()">‚ò∞</button>
                <h1>Configuraci√≥n</h1>
            </div>
            <p>M√≥dulo de configuraci√≥n</p>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
